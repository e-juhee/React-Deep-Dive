# 2.2 가상 DOM과 리액트 파이버

> ### You will learn 🤔
>- 2.2.1 DOM과 브라우저 렌더링 과정
>- 2.2.2 가상 DOM의 탄생 배경
>- 2.2.3 가상 DOM을 위한 아키텍처, 리액트 파이버
>- 2.2.4 파이버와 가상 DOM

---

### Q1. 브라우저 렌더링 과정을 설명해주세요. (경민)
- 1) 요청한 주소에 방문해 HTML 파일을 다운로드
- 2) 브라우저의 렌더링 엔진이 HTML을 파싱해 DOM 노드로 구성된 트리인 DOM을 만든다.
- 3) 2번 과정에서 CSS 파일을 만나면 CSS 파일도 다운로드한다.
- 4) 브라우저의 렌더링 엔진이 이 CSS도 파싱해서 CSS 노드로 구성된 트리인 CSSOM을 만든다.
- 5) DOM 노드를 순회하며 눈에 보이는 노드만 방문해서 해당 노드에 대한 CSSOM 정보를 찾고 여기서 발견한 CSS 스타일 정보를 이 노드에 적용한다.
    - DOM 노드에 CSS를 적용하는 과정은 크게 두 가지로 나뉜다.
    - 5-1) layout, reflow: 각 노드가 브라우저 화면의 어느 좌표에 정확히 나타내야 하는지 계산하는 과정
    - 5-2) paining: 레이아웃 단계를 거친 노드에 색과 같은 실제 유효한 모습을 그리는 과정

### Q2. 가상 DOM을 사용하는 방식이 가상 DOM을 사용하지 않는 경우보다 항상 더 빠를까요? (주희)
- 항상 빠르다고 할 수는 없다.
- 가상 DOM의 주요 이점은 효율적인 업데이트와 일관된 성능을 제공하는 것이지, 모든 상황에서 더 빠른 속도를 보장하는 것은 아니다.
- 가상 DOM이 느릴 수 있는 경우
    - 변경 사항이 매우 간단하거나 단일 요소만 업데이트하는 경우 오히려 오버헤드를 발생시킬 수 있다.
    - 가상 DOM은 메모리에 전체 DOM의 사본을 유지하므로, 메모리 사용량이 증가할 수 있다. 따라서 메모리 자원이 제한된 환경에서 문제가 될 수 있다.

### Q3. 가상 DOM은 어떤 문제를 해결하기 위해 도입되었나요? (승훈)
- (특히 SPA의 도입으로) 렌더링 이후 추가 렌더링 작업이 많아지며 DOM을 관리하는 과정에서 부담해야 할 비용이 커졌다.
- 사용자 인터랙션으로 인한 모든 변경 사항을 추적하는 것은 개발하는 입장에서 너무나 수고스러운 일이다.

### Q4. 리액트 파이버와 파이버로 이루어진 트리에 대해서 가상 DOM의 개념과 연결 지어 아는 대로 설명해 주세요. (도영)
- 리액트 파이버는 가상 DOM과 실제 DOM을 비교해서 변경 사항을 화면에 렌더링할 것을 요청하는 역할을 한다.
- 리액트 파이버 트리는 현재 모습을 담은 파이버 트리와 작업 중인 상태를 나타내는 workInProgress 트리가 존재해서 파이버의 작업이 끝나면 포인터를 변경해서 workInProgress 트리를 현재 트리로 바꾸는 더블 버퍼링 기술을 사용한다.
- 현재 UI 렌더링을 위해 존재하는 현재 트리를 기준으로 작업이 시작되며, 업데이트가 발생하면 파이버가 새로 받은 데이터로 새로운 workInProgress 트리를 빌드하고, 빌드 작업이 끝나면 다음 렌더링에 이 트리를 사용한다. 이 workInProgress 트리가 UI에 최종적으로 렌더링되어 반영되면 current가 이 workInProgress로 변경된다.

- 리액트 컴포넌트에 대한 정보를 1:1로 가지고 있는 것이 파이버이며, 리액트 아키텍처 내부에서 비동기로 작업한다.
- 실제 DOM에 반영하는 것은 동기적으로 일어나야하기에 메모리상에서 가상 DOM에 먼저 수행한 후 최종 결과물만 실제 DOM에 적용하는 방식으로 작동한다.